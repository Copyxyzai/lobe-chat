# 项目配置

本文档提供了 LobeChat 项目配置位置和方式的全面概述。

## 配置文件概览

LobeChat 使用多个配置文件,每个文件在开发和构建过程中都有特定的用途。

### 1. Next.js 配置

**文件:** `next.config.ts`

这是控制以下内容的主要 Next.js 配置文件:

- 构建设置(生产/开发)
- Webpack 配置
- 运行时模式(独立、桌面、Docker)
- PWA/Service Worker 设置
- 安全头(CSP)
- 资源优化和缓存
- 实验性功能
- 重定向和路由

使用的关键环境变量:
- `NODE_ENV` - 生产或开发模式
- `DOCKER` - Docker 构建模式
- `NEXT_PUBLIC_IS_DESKTOP_APP` - 桌面应用程序模式
- `REACT_SCAN_MONITOR_API_KEY` - React 扫描监控
- `NEXT_PUBLIC_CLIENT_DB` - 客户端数据库类型
- `ENABLED_CSP` - 内容安全策略
- `ANALYZE` - 打包分析器
- `NEXT_PUBLIC_ASSET_PREFIX` - CDN/资源前缀

### 2. TypeScript 配置

**文件:** `tsconfig.json`

配置 TypeScript 编译器选项:
- 目标 ES 版本
- 模块解析策略
- 路径别名(`@/*`, `@/database/*` 等)
- JSX 设置
- 类型检查严格性

### 3. 包管理

**文件:** 
- `package.json` - 主包配置和脚本
- `pnpm-workspace.yaml` - Monorepo 工作区配置
- `.npmrc` - npm 配置
- `.bunfig.toml` - Bun 配置

项目使用:
- `pnpm` 用于依赖管理
- `bun` 用于运行 npm 脚本
- 带工作区的 Monorepo 结构

### 4. 环境变量

**文件:**
- `.env.example` - 环境变量示例模板
- `.env.example.development` - 开发专用示例
- `.env.desktop` - 桌面应用程序配置

主要环境变量类别:

#### 安全设置
- `ACCESS_CODE` - 应用程序访问控制
- `ENABLED_CSP` - 内容安全策略
- `KEY_VAULTS_SECRET` - 数据库加密密钥

#### AI 提供商服务
- `OPENAI_API_KEY`, `OPENAI_PROXY_URL`, `OPENAI_MODEL_LIST`
- `ANTHROPIC_API_KEY`, `ANTHROPIC_PROXY_URL`
- `GOOGLE_API_KEY`
- `AZURE_API_KEY`, `AZURE_ENDPOINT`, `AZURE_API_VERSION`
- 以及许多其他 AI 提供商配置

#### 数据库
- `NEXT_PUBLIC_SERVICE_MODE` - 服务模式(服务器/客户端)
- `DATABASE_URL` - PostgreSQL 连接字符串
- `NEXT_PUBLIC_CLIENT_DB` - 客户端数据库类型

#### 身份验证
- Clerk: `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`, `CLERK_SECRET_KEY`
- NextAuth: `NEXT_PUBLIC_ENABLE_NEXT_AUTH`, `NEXT_AUTH_SECRET`
- Auth0、Casdoor 和其他提供商

#### 存储
- S3 对象存储配置
- `S3_ACCESS_KEY_ID`, `S3_SECRET_ACCESS_KEY`, `S3_BUCKET` 等

### 5. 应用程序配置

**目录:** `src/config/`

包含运行时应用程序配置:
- `modelProviders/` - AI 模型提供商配置
- `db.ts` - 数据库配置
- `featureFlags/` - 功能标志配置

### 6. 环境变量定义

**目录:** `src/envs/`

使用 `@t3-oss/env-nextjs` 的类型安全环境变量定义:
- `app.ts` - 应用程序范围的设置
- `auth.ts` - 身份验证设置
- `llm.ts` - LLM 提供商设置
- `file.ts` - 文件存储设置
- `analytics.ts` - 分析配置
- `langfuse.ts` - Langfuse 配置
- 等等...

### 7. 构建和开发工具

#### 代码检查和格式化
- `.eslintrc.js` - ESLint 配置
- `.prettierrc.js` - Prettier 配置
- `.stylelintrc.js` - Stylelint 配置
- `.remarkrc.js` / `.remarkrc.mdx.js` - Markdown 检查

#### Git 和提交
- `.husky/` - Git 钩子
- `.commitlintrc.js` - 提交消息检查
- `.changelogrc.js` - 更新日志生成
- `.releaserc.js` - 语义化发布配置

#### 测试
- `vitest.config.mts` - Vitest 测试配置

#### 数据库
- `drizzle.config.ts` - Drizzle ORM 配置

#### 文档
- `.seorc.cjs` - 文档 SEO 配置

#### 国际化
- `.i18nrc.js` - i18n 配置
- `src/locales/` - 翻译文件

### 8. 部署配置

- `Dockerfile` - 标准 Docker 构建
- `Dockerfile.database` - 启用数据库的 Docker 构建
- `Dockerfile.pglite` - PGlite 特定构建
- `docker-compose.development.yml` - 本地开发设置
- `vercel.json` - Vercel 部署设置
- `netlify.toml` - Netlify 部署设置

### 9. 编辑器配置

- `.editorconfig` - 跨编辑器设置
- `.vscode/` - VS Code 设置
- `.cursor/` - Cursor IDE 设置
- `CLAUDE.md` - Claude AI 编码助手指南

## 配置加载顺序

1. **构建时**: `next.config.ts` 读取环境变量并应用构建设置
2. **运行时(服务器)**: 来自 `.env` 或部署平台的环境变量
3. **运行时(客户端)**: 只有 `NEXT_PUBLIC_*` 变量暴露给浏览器
4. **应用程序**: `src/config/` 和 `src/envs/` 提供对配置的类型安全访问

## 最佳实践

### 环境变量
- 永远不要提交带有真实凭据的 `.env` 文件
- 使用 `.env.example` 作为模板
- 客户端变量前缀使用 `NEXT_PUBLIC_`
- 使用 `src/envs/*` 文件进行类型安全的环境变量访问

### 配置更改
- 添加新配置时更新代码和文档
- 在部署前在开发环境中测试配置更改
- 使用功能标志进行渐进式发布

### Monorepo 配置
- 工作区包可以有自己的 `package.json`
- 共享依赖项提升到根目录
- 对内部依赖项使用工作区协议(`workspace:*`)

## 常见配置任务

### 添加新的环境变量

1. 添加到 `.env.example` 并附上描述
2. 在适当的 `src/envs/*.ts` 文件中定义并验证
3. 更新文档
4. 使用类型安全导入: `import { appEnv } from '@/envs/app';`

### 更改构建设置

1. 修改 `next.config.ts`
2. 本地测试: `bun run dev`
3. 测试生产构建: `bun run build`
4. 如需要更新文档

### 添加新的 AI 提供商

1. 在 `src/config/modelProviders/[provider].ts` 中创建配置
2. 从 `src/config/modelProviders/index.ts` 导出
3. 将环境变量添加到 `.env.example`
4. 在 `src/envs/llm.ts` 中定义环境变量

## 参考文件

有关特定方面的详细信息:
- 目录结构: 参见 [folder-structure.zh-CN.mdx](./folder-structure.zh-CN.mdx)
- 开发设置: 参见 [setup-development.zh-CN.mdx](./setup-development.zh-CN.mdx)
- 环境变量: 参见 `/docs/self-hosting/environment-variables/`
- 贡献指南: 参见 [contributing-guidelines.zh-CN.mdx](./contributing-guidelines.zh-CN.mdx)
